## ReactAgent 快速开始

跟随快速开始，学习如何开发一个具备完整功能的 ReactAgent 智能体。

## 前置条件[​](#前置条件 "前置条件的直接链接")

### 环境要求[​](#环境要求 "环境要求的直接链接")

* JDK 17+
* Maven 3.8+
* 选择你的 LLM 提供商并获取 API-KEY（如阿里云百炼的 DashScope）

### 添加依赖[​](#添加依赖 "添加依赖的直接链接")

在你的项目中添加以下 Maven 依赖：

```
<dependencies>  
  <!-- Spring AI Alibaba Agent Framework -->  
  <dependency>  
    <groupId>com.alibaba.cloud.ai</groupId>  
    <artifactId>spring-ai-alibaba-agent-framework</artifactId>  
    <version>1.1.0.0-RC2</version>  
  </dependency>  
  
  <!-- DashScope ChatModel 支持（如果使用其他模型，请跳转 Spring AI 文档选择对应的 starter） -->  
  <dependency>  
    <groupId>com.alibaba.cloud.ai</groupId>  
    <artifactId>spring-ai-alibaba-starter-dashscope</artifactId>  
    <version>1.1.0.0-RC2</version>  
  </dependency>  
</dependencies>
```

### 配置 API Key[​](#配置-api-key "配置 API Key的直接链接")

在使用之前，需要配置你的 API Key。推荐通过环境变量设置：

```
export AI_DASHSCOPE_API_KEY=your_api_key_here
```

你也可以在应用配置文件中设置（不推荐在生产环境中硬编码）：

```
# application.yml  
spring:  
  ai:  
    dashscope:  
      api-key: ${AI_DASHSCOPE_API_KEY}
```

**获取 API Key**：

* DashScope（阿里云百炼）：访问 <https://bailian.console.aliyun.com/?apiKey=1&tab=api#/api>
* 其他模型提供商请 [参考文档](/integration/chatmodels/openai-chat)

## 构建一个基础 Agent[​](#构建一个基础-agent "构建一个基础 Agent的直接链接")

首先创建一个简单的 agent，它可以回答问题并调用工具。该 agent 将使用 DashScope 大模型、一个天气查询工具、以及简单的系统提示词。

```
// 初始化 ChatModel  
DashScopeApi dashScopeApi = DashScopeApi.builder()  
    .apiKey(System.getenv("AI_DASHSCOPE_API_KEY"))  
    .build();  
ChatModel chatModel = DashScopeChatModel.builder()  
    .dashScopeApi(dashScopeApi)  
    .build();  
  
// 创建 Agent  
ReactAgent agent = ReactAgent.builder()  
    .name("weather_agent")  
    .model(chatModel)  
    .instruction("You are a helpful weather forecast assistant.")  
    .build();  
  
// 运行 Agent  
agent.call("what is the weather in Hangzhou?");
```

## 进阶使用[​](#进阶使用 "进阶使用的直接链接")

Agent 不仅仅是简单的调用，还可以通过工具、Hooks 等进行扩展。

### 添加工具[​](#添加工具 "添加工具的直接链接")

你可以为 Agent 添加自定义工具，使其能够与外部系统交互。

```
// 定义工具  
ToolCallback weatherTool = FunctionToolCallback  
    .builder("get_weather", new WeatherService())  
    .description("Get the weather for a location")  
    .build();  
  
// 添加到 Agent  
ReactAgent agent = ReactAgent.builder()  
    .name("weather_agent")  
    .model(chatModel)  
    .tools(weatherTool)  
    .instruction("You are a helpful weather forecast assistant.")  
    .build();
```

### 2. 创建工具[​](#2-创建工具 "2. 创建工具的直接链接")

工具让模型能够通过调用你定义的函数与外部系统交互。工具可以依赖运行时上下文，也可以与 agent 的记忆交互。

注意下面的 `getUserLocation` 工具如何使用运行时上下文（通过 `ToolContext`）：

```
import org.springframework.ai.chat.model.ToolContext;  
import org.springframework.ai.tool.ToolCallback;  
import org.springframework.ai.tool.annotation.ToolParam;  
import org.springframework.ai.tool.function.FunctionToolCallback;  
  
import java.util.function.BiFunction;  
  
// 天气查询工具  
public class WeatherForLocationTool implements BiFunction<String, ToolContext, String> {  
    @Override  
    public String apply(  
        @ToolParam(description = "The city name") String city,  
        ToolContext toolContext) {  
        return "It's always sunny in " + city + "!";  
    }  
}  
  
// 用户位置工具 - 使用上下文  
public class UserLocationTool implements BiFunction<String, ToolContext, String> {  
    @Override  
    public String apply(  
        @ToolParam(description = "User query") String query,  
        ToolContext toolContext) {  
        // 从上下文中获取用户信息  
        String userId = "";  
        if (toolContext != null && toolContext.getContext() != null) {  
            RunnableConfig runnableConfig = (RunnableConfig) toolContext.getContext().get(AGENT_CONFIG_CONTEXT_KEY);  
            Optional<Object> userIdObjOptional = runnableConfig.metadata("user_id");  
            if (userIdObjOptional.isPresent()) {  
                userId = (String) userIdObjOptional.get();  
            }  
        }  
        if (userId == null) {  
            userId = "1";  
        }  
        return "1".equals(userId) ? "Florida" : "San Francisco";  
    }  
}  
  
// 创建工具回调  
ToolCallback getWeatherTool = FunctionToolCallback  
    .builder("getWeather", new WeatherForLocationTool())  
    .description("Get the weather for a location")  
    .build();  
ToolCallback getLocationTool = FunctionToolCallback  
    .builder("getUserLocation", new UserLocationTool())  
    .description("Get the user's location")  
    .build();
```

### 持久化对话[​](#持久化对话 "持久化对话的直接链接")

Agent 支持将会话状态持久化，以便在不同请求之间保持上下文。

```
import com.alibaba.cloud.ai.graph.agent.memory.MemorySaver;  
  
ReactAgent agent = ReactAgent.builder()  
    .name("my_agent")  
    .model(chatModel)  
    .saver(new MemorySaver())  // 使用内存存储，生产环境建议使用 Redis 或 DB  
    .build();
```

### 访问执行状态[​](#访问执行状态 "访问执行状态的直接链接")

你可以通过 `invoke` 方法获取 Agent 的完整执行状态：

```
import com.alibaba.cloud.ai.graph.OverAllState;  
import java.util.Optional;  
  
Optional<OverAllState> result = agent.invoke("帮我写一首诗。");  
  
if (result.isPresent()) {  
    OverAllState state = result.get();  
    // 访问消息历史  
    List<Message> messages = state.value("messages", new ArrayList<>());  
    // 访问其他状态信息  
    System.out.println(state);  
}
```

### 配置最大迭代次数[​](#配置最大迭代次数 "配置最大迭代次数的直接链接")

为防止无限循环，可以使用 `ModelCallLimitHook` 来限制模型调用次数：

```
import com.alibaba.cloud.ai.graph.agent.hook.modelcalllimit.ModelCallLimitHook;  
  
ModelCallLimitHook hook = ModelCallLimitHook.builder()  
    .runLimit(5)  // 限制最多调用 5 次  
    .exitBehavior(ModelCallLimitHook.ExitBehavior.ERROR)  // 超出限制时抛出异常  
    .build();  
  
ReactAgent agent = ReactAgent.builder()  
    .name("my_agent")  
    .model(chatModel)  
    .hooks(hook)  
    .saver(new MemorySaver())  
    .build();
```

### 使用 Hooks 扩展功能[​](#使用-hooks-扩展功能 "使用 Hooks 扩展功能的直接链接")

ReactAgent 支持通过 Hooks 扩展功能，例如人机协同、工具注入等：

```
import com.alibaba.cloud.ai.graph.agent.hook.Hook;  
import com.alibaba.cloud.ai.graph.agent.hook.hip.HumanInTheLoopHook;  
  
// 创建 hook  
Hook humanInTheLoopHook = HumanInTheLoopHook.builder()  
 .approvalOn("getWeatherTool", ToolConfig.builder().description("Please confirm tool execution.")  
 .build();  
  
ReactAgent agent = ReactAgent.builder()  
    .name("my_agent")  
    .model(chatModel)  
    .hooks(humanInTheLoopHook)  
    .saver(new MemorySaver())  
    .build();
```

## 下一步[​](#下一步 "下一步的直接链接")

现在你已经创建了一个基础的 ReactAgent，你可以：

* 探索更多的工具集成
* 学习如何使用不同的 Checkpoint 实现对话持久化
* 了解如何使用 Hooks 扩展 agent 功能
* 学习如何创建多 agent 系统
